<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>2. R and CF Metadata Conventions • ncdfCF</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="2. R and CF Metadata Conventions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ncdfCF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ncdfCF.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/31_Creating.html">1. Creating new data sets and variables</a></li>
    <li><a class="dropdown-item" href="../articles/32_R-CF.html">2. R and CF Metadata Conventions</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-CF/ncdfCF/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>2. R and CF Metadata Conventions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-CF/ncdfCF/blob/v0.8.0/vignettes/articles/32_R-CF.Rmd" class="external-link"><code>vignettes/articles/32_R-CF.Rmd</code></a></small>
      <div class="d-none name"><code>32_R-CF.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-cf-metadata-conventions">The CF Metadata Conventions<a class="anchor" aria-label="anchor" href="#the-cf-metadata-conventions"></a>
</h2>
<p>The CF Metadata Conventions (“CF” henceforth) are being developed by
academics and practitioners in the climate and forecasting field, with
the objective to facilitate interoperability between data producers and
data consumers (whether human or computer systems).</p>
<p>Reading the CF documentation can be a daunting task because it is
written as a conventions document, and not as a guideline or tutorial
for people who want to understand the concept and the structure but who
are not looking for all of the low-level detail.</p>
<p>This article presents a view of CF from the perspective of R. The
main elements of CF are introduced in terms that should be easily
understood by anyone who has worked with matrices and arrays in R.</p>
<p>By definition, a CF-compliant data set is stored in a netCDF file.
The CF elements and their relationship to the building blocks of the
netCDF file are given in the figure below:</p>
<div class="float">
<img src="../datamodel-0.4.svg" width="680" alt="Figure 1: Elements of a netCDF file and the CF constructs built on them. Source: CF Conventions, Appendix I."><div class="figcaption"><em>Figure 1: Elements of a netCDF file and the
CF constructs built on them. Source: CF Conventions, Appendix
I.</em></div>
</div>
<p>If you’ve worked with netCDF data in R before, probably using package
<code>ncdf4</code> (but what follows is equally true when you use
package <code>RNetCDF</code>), you should be familiar with the yellow
boxes in the above figure, especially “NC::Variable” (the specific
notation used in the figure is not important here), corresponding to the
<code>ncvar4</code> class in <code>ncdf4</code>. CF, however, recognizes
11 different objects that are each based on an “NC::Variable”. This
ranges from axes, or <em>generic coordinate variables</em> in the white
box in the figure, to <em>grid mapping variables</em> (that define the
coordinate reference system of your data) to the actual data array in a
<em>data variable</em>. This is the source of all those surprising
“variables” that you see when you do <code>names(nc$var)</code>:</p>
<pre><code><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://cirrus.ucsd.edu/~pierce/ncdf/" class="external-link">ncdf4</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tasmax_NAM-44_day_20410701-vncdfCF.nc"</span>, package <span class="op">=</span> <span class="st">"ncdfCF"</span><span class="op">)</span></span>
<span><span class="va">nc</span> <span class="op">&lt;-</span> <span class="fu">nc_open</span><span class="op">(</span><span class="va">fn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The "variables"</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">var</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "time_bnds"         "lon"               "lat"              </span></span>
<span><span class="co">#&gt; [4] "Lambert_Conformal" "height"            "tasmax"</span></span>
<span></span>
<span><span class="co"># The dimensions</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">nc</span><span class="op">$</span><span class="va">dim</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "time" "bnds" "x"    "y"</span></span></code></pre>
<p>So which of these variables is the one that holds your data? And how
do you tell it apart from the other “variables”? And why are there
<code>x</code> and <code>y</code> dimensions and <code>lon</code> and
<code>lat</code> “variables”?</p>
<div class="section level3">
<h3 id="enter-the-attributes">Enter the attributes<a class="anchor" aria-label="anchor" href="#enter-the-attributes"></a>
</h3>
<p>You may not be as familiar with the attributes in the netCDF file,
the “NC::Attribute” object in the above figure, as <code>ncdf4</code>
does not make these as easily accessible as the other information in the
file. That is a shame because attributes are the thing that makes netCDF
stand apart from pretty much any other gridded data format. CF is
actually all about attributes, with some of them organized in
“NC::Variable” objects that do not hold any other data! (Such as the
<em>grid mapping variables</em> mentioned above.) Put the other way
around, you are not really using a CF-compliant netCDF data set unless
you read the proper attributes. Even stronger: there are things in
netCDF data sets that you cannot do unless you have inspect the
attributes (such as determining the coordinate reference system, or
calculating the parametric coordinates of a vertical axis).</p>
<p>Looking at the same netCDF file as above, but now using the
<code>ncdfCF</code> package:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/R-CF/ncdfCF" class="external-link">ncdfCF</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">fn</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tasmax_NAM-44_day_20410701-vncdfCF.nc"</span>, package <span class="op">=</span> <span class="st">"ncdfCF"</span><span class="op">)</span></span>
<span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_ncdf.html">open_ncdf</a></span><span class="op">(</span><span class="va">fn</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The data variable</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">ds</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "tasmax"</span></span>
<span></span>
<span><span class="co"># The details of the data variable</span></span>
<span><span class="va">tmax</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[[</span><span class="st">"tasmax"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">tmax</span><span class="op">$</span><span class="fu">print</span><span class="op">(</span>width <span class="op">=</span> <span class="fl">25</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Variable&gt; tasmax </span></span>
<span><span class="co">#&gt; Long name: Daily Maximum Near-Surface Air Temperature </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Values: (not loaded)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coordinate reference system:</span></span>
<span><span class="co">#&gt;  name              grid_mapping           </span></span>
<span><span class="co">#&gt;  Lambert_Conformal lambert_conformal_conic</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Axes:</span></span>
<span><span class="co">#&gt;  axis name   long_name                 length values               </span></span>
<span><span class="co">#&gt;  X    x      x-coordinate in Cartes... 148    [0 ... 7350000]      </span></span>
<span><span class="co">#&gt;  Y    y      y-coordinate in Cartes... 140    [0 ... 6950000]      </span></span>
<span><span class="co">#&gt;  T    time                             1-U    [2041-07-01T12:00:00]</span></span>
<span><span class="co">#&gt;  Z    height                           1      [2]                  </span></span>
<span><span class="co">#&gt;  unit                     </span></span>
<span><span class="co">#&gt;  m                        </span></span>
<span><span class="co">#&gt;  m                        </span></span>
<span><span class="co">#&gt;  days since 1949-12-1 0...</span></span>
<span><span class="co">#&gt;  m                        </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Auxiliary longitude-latitude grid:</span></span>
<span><span class="co">#&gt;  axis name extent                 unit         </span></span>
<span><span class="co">#&gt;  X    lon  [-174.382 ... -19.618] degrees_east </span></span>
<span><span class="co">#&gt;  Y    lat  [10.154 ... 76.459]    degrees_north</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name          type    length value                    </span></span>
<span><span class="co">#&gt;  standard_name NC_CHAR 15     air_temperature          </span></span>
<span><span class="co">#&gt;  long_name     NC_CHAR 42     Daily Maximum Near-Sur...</span></span>
<span><span class="co">#&gt;  units         NC_CHAR  1     K                        </span></span>
<span><span class="co">#&gt;  grid_mapping  NC_CHAR 17     Lambert_Conformal        </span></span>
<span><span class="co">#&gt;  original_name NC_CHAR 11     TEMP at 2 M              </span></span>
<span><span class="co">#&gt;  cell_methods  NC_CHAR 13     time: maximum            </span></span>
<span><span class="co">#&gt;  FieldType     NC_INT   1     104                      </span></span>
<span><span class="co">#&gt;  MemoryOrder   NC_CHAR  3     XY</span></span>
<span></span>
<span><span class="co"># The "time" axis</span></span>
<span><span class="va">ds</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;Time axis&gt; [0] time</span></span>
<span><span class="co">#&gt; Length     : 1 (unlimited)</span></span>
<span><span class="co">#&gt; Axis       : T </span></span>
<span><span class="co">#&gt; Calendar   : 365_day </span></span>
<span><span class="co">#&gt; Range      : 2041-07-01T12:00:00 (days) </span></span>
<span><span class="co">#&gt; Bounds     : 2041-07-01 ... 2041-07-02 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name          type      length value                        </span></span>
<span><span class="co">#&gt;  standard_name NC_CHAR    4     time                         </span></span>
<span><span class="co">#&gt;  long_name     NC_CHAR    4     time                         </span></span>
<span><span class="co">#&gt;  bounds        NC_CHAR    9     time_bnds                    </span></span>
<span><span class="co">#&gt;  units         NC_CHAR   29     days since 1949-12-1 00:00:00</span></span>
<span><span class="co">#&gt;  calendar      NC_CHAR    7     365_day                      </span></span>
<span><span class="co">#&gt;  axis          NC_CHAR    1     T                            </span></span>
<span><span class="co">#&gt;  actual_range  NC_DOUBLE  2     33427.5, 33427.5</span></span>
<span></span>
<span><span class="co"># Parameters in the grid mapping variable</span></span>
<span><span class="va">ds</span><span class="op">[[</span><span class="st">"Lambert_Conformal"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; &lt;Grid mapping&gt; Lambert_Conformal </span></span>
<span><span class="co">#&gt; Grid mapping name: lambert_conformal_conic </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name                          type      length value                  </span></span>
<span><span class="co">#&gt;  grid_mapping_name             NC_CHAR   23     lambert_conformal_conic</span></span>
<span><span class="co">#&gt;  longitude_of_central_meridian NC_DOUBLE  1     -97                    </span></span>
<span><span class="co">#&gt;  latitude_of_projection_origin NC_DOUBLE  1     46.0000038146973       </span></span>
<span><span class="co">#&gt;  standard_parallel             NC_DOUBLE  2     35, 60                 </span></span>
<span><span class="co">#&gt;  false_easting                 NC_DOUBLE  1     3675000                </span></span>
<span><span class="co">#&gt;  false_northing                NC_DOUBLE  1     3475000</span></span></code></pre></div>
<p>Ok, that’s a lot more information. Let’s focus on a few important
things:</p>
<ol style="list-style-type: decimal">
<li>There is only one <em>data variable</em>, called “tasmax”. If we
examine it’s details we can see that it’s coordinate space uses four
axes <code>x</code>, <code>y</code>, <code>time</code> and
<code>height</code>. That is not all clear from the <code>ncdf4</code>
output which lists the first three dimensions and excludes
<code>height</code>, but includes <code>bnds</code> instead.</li>
<li>The data set has a <em>grid mapping variable</em> called
<code>Lambert_Conformal</code> that, by definition, applies to the
<code>X</code> and <code>Y</code> axes of the <em>data variable</em>
<code>tasmax</code>. As suggested by CF, the data set also includes two
<em>auxilliary coordinate variables</em> <code>lat</code> and
<code>lon</code>, each a matrix with the same dimension as the length of
the <code>Y</code> and <code>X</code> axes of the <em>data variable</em>
they are associated with, where each cell gives the latitude and
longitude, respectively, of the corresponding cell in the <em>data
variable</em> (whose axes have coordinates in the Lambert Conformal
coordinate reference system). You can identify these two aspects by
looking at the attributes of <code>tasmax</code>: attribute
<code>grid_mapping</code> points to the <em>grid mapping variable</em>
<code>Lambert_Conformal</code>, attribute <code>coordinates</code> lists
both the <em>scalar coordinate variable</em> <code>height</code> and the
<em>auxiliary coordinate variables</em> <code>lat</code> and
<code>lon</code>.</li>
<li>The <code>time</code> axis has an attribute <code>bounds</code>
which points to <code>time_bnds</code>, a <em>boundary variable</em>
that indicates for each coordinate along the axis its lower and higher
values. For the <code>time</code> axis there is just one coordinate at
<code>2041-07-01 12:00:00</code> with range values
<code>2041-07-01 ... 2041-07-02</code> (midnight to midnight). (It is
the <code>time_bnds</code> <em>boundary variable</em> that uses the
<code>bnds</code> dimension that <code>ncdf4</code> reports.) The
<code>calendar</code> used by this axis is <code>365_day</code>, meaning
that no year uses the leap day of 29 February. This is a so-called
“model calendar” and the standard date-time functions will not work
properly with this data; use the built-in time methods instead.</li>
</ol>
<p>It should be obvious that correctly interpreting a netCDF file
requires a package that not only provides easy access to the attributes
of the file, but that also applies the CF conventions to put all the
pieces together in such a way that the data set is presented to the user
of the data - that would be you - as the data producers intended.</p>
<p>The issues arising from the pecularities of CF on top of the netCDF
format are presented and discussed in the remainder of this document,
seen from the perspective of the R user, with examples using the
<code>ncdfCF</code> package. At the end of this article is a feature
matrix that indicates the support for each CF element in package
<code>ncdfCF</code>.</p>
<blockquote>
<p>Please note that I have nothing against <code>ncdf4</code> or
<code>RNetCDF</code> packages. In fact, package <code>ncdfCF</code> is
built on top of <code>RNetCDF</code>. My point is merely to demonstrate
how CF-compliant netCDF files, of which there are <em>very</em> many out
there on the internet, require you to look beyond the basic netCDF
building blocks and use the attributes. If your netCDF files do not use
the CF conventions, then by all means use <code>ncdf4</code> if you
prefer. I would suggest, though, to read the next section to understand
better how data structures in netCDF differ from R standard
practices.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="arrays-in-r-versus-netcdf-files">Arrays in R versus netCDF files<a class="anchor" aria-label="anchor" href="#arrays-in-r-versus-netcdf-files"></a>
</h2>
<p>In R, matrices and arrays are stored in column-major ordering,
meaning that successive values go from the top-left down down the
column, then across the columns to the bottom-right. This is easily seen
when printing a matrix to the console:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    1    4    7   10</span></span>
<span><span class="co">#&gt; [2,]    2    5    8   11</span></span>
<span><span class="co">#&gt; [3,]    3    6    9   12</span></span></code></pre></div>
<p>In netCDF files matrices and arrays are stored in row-major ordering,
starting from the left, progressing to the end of the row and then to
the next row. This can be performed in R with the <code>byrow</code>
argument of the <code><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix()</a></code> function, with data starting from
the top-left:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">12</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    1    2    3    4</span></span>
<span><span class="co">#&gt; [2,]    5    6    7    8</span></span>
<span><span class="co">#&gt; [3,]    9   10   11   12</span></span></code></pre></div>
<p>CF-compliant data sets, however, are free to store the data in any
possible organization of the axes, although the recommendation is to use
the longitude - latitude - vertical - time - others ordering. But even
when that recommendation is followed, the latitude coordinates in the
row are often stored in ascending order from South to North, that is
from the bottom-left working upwards. That looks like this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">6</span>, <span class="fl">2</span>, <span class="fl">11</span>, <span class="fl">7</span>, <span class="fl">3</span>, <span class="fl">12</span>, <span class="fl">8</span>, <span class="fl">4</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">3</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span><span class="co">#&gt; [1,]    9   10   11   12</span></span>
<span><span class="co">#&gt; [2,]    5    6    7    8</span></span>
<span><span class="co">#&gt; [3,]    1    2    3    4</span></span></code></pre></div>
<p>This is the cause of lots of headaches and “patches” involving
<code><a href="https://rspatial.github.io/terra/reference/transpose.html" class="external-link">t()</a></code> and <code><a href="https://rspatial.github.io/terra/reference/flip.html" class="external-link">rev()</a></code> in <em>some</em> order and
general exasperation (<em>“why does it have to be so
complicated?”</em>).</p>
<p>The bottom line is that there is no guarantee that the data are
stored in a particular ordering. So how can you make sure that you get
the data from the netCDF file in a predictable format so that you can
use your favourite analysis routines with peace of mind? The answer
should be obvious: read the attributes of the netCDF file and apply them
following CF guidelines.</p>
<p>Lucky for you package <code>ncdfCF</code> does all the dirty work
behind the scene to give you easy access to either the raw array data,
in the ordering found in the netCDF file, or an oriented array that
follows the standard R array layout:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The raw data using the ordering in the netCDF file (or as modified by</span></span>
<span><span class="co"># a processing method such as `summarise()`)</span></span>
<span><span class="va">tmax_raw</span> <span class="op">&lt;-</span> <span class="va">tmax</span><span class="op">$</span><span class="fu">raw</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tmax_raw</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:148, 1:140, 1, 1] 301 301 301 301 301 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "dimnames")=List of 4</span></span>
<span><span class="co">#&gt;   ..$ x     : chr [1:148] "0" "50000" "1e+05" "150000" ...</span></span>
<span><span class="co">#&gt;   ..$ y     : chr [1:140] "0" "50000" "1e+05" "150000" ...</span></span>
<span><span class="co">#&gt;   ..$ time  : chr "2041-07-01T12:00:00"</span></span>
<span><span class="co">#&gt;   ..$ height: chr "2"</span></span>
<span></span>
<span><span class="co"># The same data but now in standard R ordering</span></span>
<span><span class="va">tmax_R</span> <span class="op">&lt;-</span> <span class="va">tmax</span><span class="op">$</span><span class="fu">array</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">tmax_R</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:140, 1:148, 1, 1] 277 277 277 277 277 ...</span></span>
<span><span class="co">#&gt;  - attr(*, "dimnames")=List of 4</span></span>
<span><span class="co">#&gt;   ..$ y     : chr [1:140] "6950000" "6900000" "6850000" "6800000" ...</span></span>
<span><span class="co">#&gt;   ..$ x     : chr [1:148] "0" "50000" "1e+05" "150000" ...</span></span>
<span><span class="co">#&gt;   ..$ height: chr "2"</span></span>
<span><span class="co">#&gt;   ..$ time  : chr "2041-07-01T12:00:00"</span></span></code></pre></div>
<p>Note how in the <code><a href="https://rdrr.io/r/base/array.html" class="external-link">array()</a></code> version the <code>x</code> and
<code>y</code> axes are reversed and the <code>y</code> values decrease,
i.e. working from the top-left down to the bottom-right, just like a
standard R array.</p>
</div>
<div class="section level2">
<h2 id="ncdfcf-data-model-in-a-nutshell">ncdfCF data model in a nutshell<a class="anchor" aria-label="anchor" href="#ncdfcf-data-model-in-a-nutshell"></a>
</h2>
<p>The netCDF file format is very flexible, as well as CF, and the
<code>ncdfCF</code> package uses a layered structure to capture it all.
This structure enables a full support of the features provided by the
<code>netcdf</code> library and the CF Conventions.</p>
<div class="float">
<img src="../ncdfCF-datamodel-0.7.png" width="680" alt="Figure 2: Core ncdfCF data model"><div class="figcaption">Figure 2: Core ncdfCF data model</div>
</div>
<p>Each of the building blocks may have other objects associated with
it, such as axes for <code>CFVariable</code>. Package
<code>ncdfCF</code> is built using the <code>R6</code> OOP framework and
uses class hierarchies throughout. The crucial but humble “virtual”
class <code>CFAxis</code> is not used directly, instead you’ll work with
its seven descendant classes. <code>CFVariable</code> has several
specialised sub-classes, such as <code>CFVariableL3b</code> for NASA
level-3 binned data used for MODIS imagery, or
<code>CFVerticalParametricTerm</code> which you will encounter when
using <em>formula terms</em> for a parametric vertical axis.</p>
<div class="float">
<img src="../ncdfCF-hierarchy-0.7.png" width="680" alt="Figure 3: Condensed ncdfCF axis class hierarchy"><div class="figcaption">Figure 3: Condensed ncdfCF axis class
hierarchy</div>
</div>
</div>
<div class="section level2">
<h2 id="feature-matrix">Feature matrix<a class="anchor" aria-label="anchor" href="#feature-matrix"></a>
</h2>
<p>This section provides an overview of how this package implements the
various elements of the CF Conventions.</p>
<div class="section level4">
<h4 id="netcdf-files-and-components">2. NetCDF files and components<a class="anchor" aria-label="anchor" href="#netcdf-files-and-components"></a>
</h4>
<div class="section level5">
<h5 id="filename">2.1. Filename<a class="anchor" aria-label="anchor" href="#filename"></a>
</h5>
<p>Any filename extension is allowed.</p>
</div>
<div class="section level5">
<h5 id="data-types">2.2. Data types<a class="anchor" aria-label="anchor" href="#data-types"></a>
</h5>
<p>Any allowable data type can be read to and written from a netCDF
file. In R, only the standard data types are used.</p>
</div>
<div class="section level5">
<h5 id="naming-conventions">2.3. Naming conventions<a class="anchor" aria-label="anchor" href="#naming-conventions"></a>
</h5>
<p>It is <em>required</em> that variable, dimension, attribute and group
names begin with a letter and be composed of letters, digits, and
underscores. The maximum length of a name is 255 characters.</p>
<p>Names of NC variables - thus the names of CF objects built on top of
them as well - must be unique, disregarding the case of the name,
<em>within the group</em> in which the NC variable is defined. Scoping
at group level is not mentioned in the CF conventions and this is thus
an extension of the conventions.</p>
</div>
<div class="section level5">
<h5 id="dimensions">2.4. Dimensions<a class="anchor" aria-label="anchor" href="#dimensions"></a>
</h5>
<p>Fully implemented. Scalar coordinate variables are supported in
reading and writing, but internally represented as an axis with length
1.</p>
</div>
<div class="section level5">
<h5 id="variables">2.5. Variables<a class="anchor" aria-label="anchor" href="#variables"></a>
</h5>
<p>The <code>actual_range</code> attribute is determined when a
<code>CFVariable</code> is created from a netCDF resource or its values
modified in code. The attribute is also attached to all axes and their
boundaries.</p>
<p>Upon saving a <code>CFVariable</code> to a netCDF file, data may be
packed and the appropriate attributes will be written along with the
data.</p>
</div>
<div class="section level5">
<h5 id="attributes">2.6. Attributes<a class="anchor" aria-label="anchor" href="#attributes"></a>
</h5>
<p>This package only interprets attributes that are defined by CF to
have a special meaning that is relevant to reading, processing or
writing data. Other attributes are read and presented to the user.</p>
<p>The attribute <code>Conventions</code> is written to file with value
“CF-1.13”.</p>
<p>The attribute <code>history</code> is created in the group of the
data variable or prepended with information on any processing that has
been applied to the data.</p>
<p>Other global, group or data variable attributes are not written to
file automatically; the user has to add to amend these attributes
explicitly.</p>
</div>
<div class="section level5">
<h5 id="groups">2.7. Groups<a class="anchor" aria-label="anchor" href="#groups"></a>
</h5>
<p>Fully implemented. This includes lateral search <em>for all
objects</em>, which is allowed but discouraged by CF for regular
coordinate variables only. Lateral search is included because some
important data collections, particularly in the field of earth
observation, depend on it to locate related objects over complex group
hierarchies.</p>
</div>
<div class="section level5">
<h5 id="aggregation-variables">2.8. Aggregation variables<a class="anchor" aria-label="anchor" href="#aggregation-variables"></a>
</h5>
<p>Not implemented.</p>
</div>
</div>
<div class="section level4">
<h4 id="description-of-the-data">3. Description of the data<a class="anchor" aria-label="anchor" href="#description-of-the-data"></a>
</h4>
<div class="section level5">
<h5 id="units">3.1. Units<a class="anchor" aria-label="anchor" href="#units"></a>
</h5>
<p>The package optionally uses the <code>units</code> package which
provides access to the UDUNITS library to manage units or convert
between them.</p>
<p>The <code>units</code> attribute is interpreted for axes and
effectively required for the dimensions “that receive special treatment”
(see sections 4.1 - 4.4) or they will not be recognized as such.
Otherwise presence or contents of the attribute is not tested.</p>
<p>The <code>units_metadata</code> attribute is not managed by this
package. It is the responsibility of the user to set the appropriate
value.</p>
<p>Attributes <code>scale_factor</code> and <code>add_offset</code> are
only used for packing data (section 8.1).</p>
</div>
<div class="section level5">
<h5 id="long-name">3.2 Long name<a class="anchor" aria-label="anchor" href="#long-name"></a>
</h5>
<p>Supported for all objects that have this attribute.</p>
</div>
<div class="section level5">
<h5 id="standard-name">3.3 Standard name<a class="anchor" aria-label="anchor" href="#standard-name"></a>
</h5>
<p>The standard names table can optionally (and automatically) be
accessed through the <code>CF$standard_names</code> object. Management
of the XML is automatic, including periodic checks to see if an update
is available.</p>
<p>The <code>standard_name</code> attribute is read but not checked
against the standard name table. Objects with a
<code>standard_name</code> attribute can be identified with the
<code>CFDataset$objects_by_standard_name()</code> method, either for
presence of the attribute or using a specific standard name.</p>
</div>
<div class="section level5">
<h5 id="ancillary-data">3.4. Ancillary data<a class="anchor" aria-label="anchor" href="#ancillary-data"></a>
</h5>
<p>Fully implemented.</p>
</div>
<div class="section level5">
<h5 id="flags">3.5. Flags<a class="anchor" aria-label="anchor" href="#flags"></a>
</h5>
<p>Not implemented directly but using the <code>flag_values</code> and
<code>flag_meanings</code> attributes is trivial on the user side.</p>
</div>
</div>
<div class="section level4">
<h4 id="coordinate-types">4. Coordinate types<a class="anchor" aria-label="anchor" href="#coordinate-types"></a>
</h4>
<p>When opening a netCDF resource, axes are scanned for using the
<code>units</code> or <code>axis</code> attribute, then the
<code>standard_name</code>, and finally, as an extension to CF, by its
<code>name</code> attribute.</p>
<p>Upon writing, the <code>axis</code> attribute is added, if defined
and not already present.</p>
<div class="section level5">
<h5 id="latitude-coordinate">4.1. Latitude coordinate<a class="anchor" aria-label="anchor" href="#latitude-coordinate"></a>
</h5>
<p>Fully implemented.</p>
</div>
<div class="section level5">
<h5 id="longitude-coordinate">4.2. Longitude coordinate<a class="anchor" aria-label="anchor" href="#longitude-coordinate"></a>
</h5>
<p>Fully implemented.</p>
</div>
<div class="section level5">
<h5 id="vertical-heigth-or-depth-coordinate">4.3. Vertical (heigth or depth) coordinate<a class="anchor" aria-label="anchor" href="#vertical-heigth-or-depth-coordinate"></a>
</h5>
<p>Fully implemented for dimensional vertical axes. If the
<code>units</code> library is available, a unit of pressure will be
identified.</p>
<p>Parametric vertical coordinates are partially supported. Of the nine
available formulations, the “Ocean s-coordinate, generic form 1”, “Ocean
s-coordinate, generic form 2” and “Atmosphere hybrid sigma pressure
coordinate” are implemented. Other formulations will be implemented as
sample data is made available for testing the code.</p>
</div>
<div class="section level5">
<h5 id="time-coordinate">4.4. Time coordinate<a class="anchor" aria-label="anchor" href="#time-coordinate"></a>
</h5>
<p>The time coordinate is managed by the <a href="https://cran.r-project.org/package=CFtime" class="external-link">CFtime</a> package. All
defined calendars, including the recently added <code>utc</code> and
<code>tai</code> calendars, are supported. Leap seconds are fully
supported in notation and arithmetic when using the <code>utc</code>
calendar.</p>
<p>When encountered upon opening a netCDF resource, the deprecated
<code>gregorian</code> calendar is replaced by the equivalent
<code>standard</code> calendar in the user-facing code.</p>
<p>Time coordinates with an explicitly defined calendar is not
supported.</p>
</div>
<div class="section level5">
<h5 id="discrete-axis">4.5. Discrete axis<a class="anchor" aria-label="anchor" href="#discrete-axis"></a>
</h5>
<p>Fully supported.</p>
</div>
</div>
<div class="section level4">
<h4 id="coordinate-systems-and-domain">5. Coordinate systems and domain<a class="anchor" aria-label="anchor" href="#coordinate-systems-and-domain"></a>
</h4>
<p>The <code>coordinates</code> attribute is interpreted, both for
<em>coordinate variables</em> and <em>auxiliary coordinate
variables</em>.</p>
<p>In <code>ncdfCF</code>, <em>auxiliary coordinate variables</em> will
have axis orientations attached to them for ease-of-use and
identification. This orientation will not be written to file as an
<code>axis</code> attribute.</p>
<div class="section level5">
<h5 id="independent-latitude-longitude-vertical-and-time-axes">5.1. Independent latitude, longitude, vertical, and time axes<a class="anchor" aria-label="anchor" href="#independent-latitude-longitude-vertical-and-time-axes"></a>
</h5>
<p>Fully supported.</p>
</div>
<div class="section level5">
<h5 id="two-dimensional-latitude-longitude-coordinate-variables">5.2. Two-dimensional latitude, longitude, coordinate variables<a class="anchor" aria-label="anchor" href="#two-dimensional-latitude-longitude-coordinate-variables"></a>
</h5>
<p>Fully supported. When higher-dimension arrays are found that are used
in this context (such as an additional “time” coordinate variable) those
higher dimensions are silently dropped both from the auxiliary
coordinate variable and its bounds, if present.</p>
</div>
<div class="section level5">
<h5 id="reduced-horizontal-grid">5.3. Reduced horizontal grid<a class="anchor" aria-label="anchor" href="#reduced-horizontal-grid"></a>
</h5>
<p>Not supported. But do note that one significant data collection of
netCDF files using a reduced horizontal grid, MODIS level-3 binned
format, uses a different format than the CF arrangement.
<code>ncdfCF</code> does read this format without problem (extending CF
by also supporting netCDF user-defined types).</p>
</div>
<div class="section level5">
<h5 id="horizontal-coordinate-reference-systems-grid-mappings-and-projections">5.6. Horizontal coordinate reference systems, grid mappings, and
projections<a class="anchor" aria-label="anchor" href="#horizontal-coordinate-reference-systems-grid-mappings-and-projections"></a>
</h5>
<p>The simple <code>grid_mapping</code> format is fully supported. The
extended, second format is not supported. The <code>standard_name</code>
on coordinate variables is not used; instead use is made of the axis
orientation (either through the <code>axis</code> attribute or through
another supported mechanism; see section 4.).</p>
<p><code>ncdfCF</code> uses OGC WKT2 strings to report on coordinate
reference systems, rather than the stock-old and obsolete PROJ format as
is suggested by CF.</p>
<p>The <code>crs_wkt</code> attribute is used when found.</p>
</div>
<div class="section level5">
<h5 id="scalar-coordinate-variables">5.7. Scalar coordinate variables<a class="anchor" aria-label="anchor" href="#scalar-coordinate-variables"></a>
</h5>
<p>Fully supported but internally represented as a regular axis of
length 1.</p>
</div>
<div class="section level5">
<h5 id="domain-variables">5.8. Domain variables<a class="anchor" aria-label="anchor" href="#domain-variables"></a>
</h5>
<p>Not implemented.</p>
</div>
<div class="section level5">
<h5 id="mesh-topology-variables">5.9. Mesh topology variables<a class="anchor" aria-label="anchor" href="#mesh-topology-variables"></a>
</h5>
<p>Not implemented.</p>
</div>
</div>
<div class="section level4">
<h4 id="labels-and-alternative-coordinates">6. Labels and alternative coordinates<a class="anchor" aria-label="anchor" href="#labels-and-alternative-coordinates"></a>
</h4>
<div class="section level5">
<h5 id="labels">6.1. Labels<a class="anchor" aria-label="anchor" href="#labels"></a>
</h5>
<p>Generic labels are supported. This includes multiple sets of labels
per axis. Labels can be used for display as well as in selection.</p>
<p>Geographic regions are also supported but not referenced against the
list of <em>standardized region names</em>, as that list is severely
restrictive, and neither is the <code>standard_name</code> attribute
referenced in this context.</p>
<p>Taxon names and identifiers and their specific attributes are not
specifically interpreted.</p>
</div>
<div class="section level5">
<h5 id="alternative-coordinates">6.2. Alternative coordinates<a class="anchor" aria-label="anchor" href="#alternative-coordinates"></a>
</h5>
<p>These are not specifically supported but they will be read
correctly.</p>
</div>
</div>
<div class="section level4">
<h4 id="data-representative-of-cells">7. Data representative of cells<a class="anchor" aria-label="anchor" href="#data-representative-of-cells"></a>
</h4>
<div class="section level5">
<h5 id="cell-boundaries">7.1. Cell boundaries<a class="anchor" aria-label="anchor" href="#cell-boundaries"></a>
</h5>
<p>Fully supported for 1D and 2D coordinate variables. More strictly
than the conventions, the coordinate value must fall on or between its
two boundary values (which the conventions merely recommend).</p>
<p>Higher dimension boundaries on coordinate variables are not yet
supported.</p>
</div>
<div class="section level5">
<h5 id="cell-measures">7.2. Cell measures<a class="anchor" aria-label="anchor" href="#cell-measures"></a>
</h5>
<p>Fully supported.</p>
<p>External variables can be linked to the <code>CFCellMeasure</code>
instances that are created upon reading a netCDF resource and will then
automatically be available to any referring data variables.</p>
</div>
<div class="section level5">
<h5 id="cell-methods">7.3. Cell methods<a class="anchor" aria-label="anchor" href="#cell-methods"></a>
</h5>
<p>The <code>cell_methods</code> attribute is read, as all other
attributes are, but it is not parsed or interpreted.</p>
<p>Interactive users and packages built on top of <code>ncdfCF</code>
should update the attribute after applying an operation to any data
variable as the package does not have enough information to do so
programmatically. A case in point is the
<code>CFVariable::summarise()</code> method: the function to apply in
summarising is user-supplied and this package has no knowledge of what
that function does or results in: apart from built-in functions like
<code><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">mean()</a></code> or <code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max()</a></code>, users can supply a
custom-made function with multiple results and thus multiple resulting
<code>CFVariable</code> instances that each need a specific update to
the <code>cell_methods</code> attribute copied from the data variable
being summarised.</p>
</div>
<div class="section level5">
<h5 id="climatological-statistics">7.4. Climatological statistics<a class="anchor" aria-label="anchor" href="#climatological-statistics"></a>
</h5>
<p>Climatological time series and their <code>climatology</code> bounds
can be read from file.</p>
<p>Climatological statistics are generated when using the
<code>CFVariable::summarise()</code> method and written to file,
including their bounds.</p>
<p>The corresponding <code>cell_methods</code> are not yet
supported.</p>
</div>
<div class="section level5">
<h5 id="geometries">7.5. Geometries<a class="anchor" aria-label="anchor" href="#geometries"></a>
</h5>
<p>Not implemented.</p>
</div>
</div>
<div class="section level4">
<h4 id="reduction-of-dataset-size">8. Reduction of dataset size<a class="anchor" aria-label="anchor" href="#reduction-of-dataset-size"></a>
</h4>
<div class="section level5">
<h5 id="packed-data">8.1. Packed data<a class="anchor" aria-label="anchor" href="#packed-data"></a>
</h5>
<p>Fully supported on reading and writing.</p>
</div>
<div class="section level5">
<h5 id="lossless-compression-by-gathering">8.2. Lossless compression by gathering<a class="anchor" aria-label="anchor" href="#lossless-compression-by-gathering"></a>
</h5>
<p>Not implemented.</p>
</div>
<div class="section level5">
<h5 id="lossy-compression-by-coordinate-subsampling">8.3. Lossy compression by coordinate subsampling<a class="anchor" aria-label="anchor" href="#lossy-compression-by-coordinate-subsampling"></a>
</h5>
<p>Not implemented.</p>
</div>
<div class="section level5">
<h5 id="lossy-compression-via-quantization">8.4. Lossy compression via quantization<a class="anchor" aria-label="anchor" href="#lossy-compression-via-quantization"></a>
</h5>
<p>Not implemented.</p>
</div>
</div>
<div class="section level4">
<h4 id="discrete-sampling-geometries">9. Discrete sampling geometries<a class="anchor" aria-label="anchor" href="#discrete-sampling-geometries"></a>
</h4>
<p>Not implemented.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Van Laake.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

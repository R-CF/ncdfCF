<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>3. Troubleshooting • ncdfCF</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="3. Troubleshooting">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">ncdfCF</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.8.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/ncdfCF.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/31_Creating.html">1. Creating new data sets and variables</a></li>
    <li><a class="dropdown-item" href="../articles/32_R-CF.html">2. R and CF Metadata Conventions</a></li>
    <li><a class="dropdown-item" href="../articles/33_Troubleshooting.html">3. Troubleshooting</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/R-CF/ncdfCF/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>3. Troubleshooting</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/R-CF/ncdfCF/blob/HEAD/vignettes/articles/33_Troubleshooting.Rmd" class="external-link"><code>vignettes/articles/33_Troubleshooting.Rmd</code></a></small>
      <div class="d-none name"><code>33_Troubleshooting.Rmd</code></div>
    </div>

    
    
<p>This page contains solutions for some of the more common problems
encountered with the <code>ncdfCF</code> package and netCDF data.</p>
<p>If you have a problem or are encountering an error and there is no
solution to be found on this page, please open an <a href="https://github.com/R-CF/ncdfCF/issues" class="external-link">issue</a>.</p>
<div class="section level2">
<h2 id="cant-assign-a-value-to-a-cf-object">Can’t assign a value to a CF object<a class="anchor" aria-label="anchor" href="#cant-assign-a-value-to-a-cf-object"></a>
</h2>
<pre><code><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_ncdf.html">open_ncdf</a></span><span class="op">(</span><span class="st">"my_data.nc"</span><span class="op">)</span></span>
<span><span class="va">ds</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">orientation</span> <span class="op">&lt;-</span> <span class="st">"T"</span></span>
<span><span class="co">#&gt; Error in `ds[["time"]]$orientation &lt;- "T"`:</span></span>
<span><span class="co">#&gt; ! cannot add bindings to a locked environment</span></span></code></pre>
<p>This is an issue related to how R interprets the code.
<code>ncdfCF</code> is built using the <code>R6</code> framework and the
<code>ncdfCF</code> classes are thus environments. The sore point is
assigning a value to an indirectly referenced object using the
<code>[[</code> indexing operator. The solution is then to first take a
reference to the object you’d like to assign a value to:</p>
<pre><code><span><span class="va">axT</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[[</span><span class="st">"time"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">axT</span><span class="op">$</span><span class="va">orientation</span> <span class="op">&lt;-</span> <span class="st">"T"</span></span>
<span><span class="va">axT</span></span>
<span><span class="co">#&gt; &lt;Time axis&gt; [0] time</span></span>
<span><span class="co">#&gt; Length     : 1800 (unlimited)</span></span>
<span><span class="co">#&gt; Axis       : T </span></span>
<span><span class="co">#&gt; Calendar   : 360_day </span></span>
<span><span class="co">#&gt; Range      : 2041-01-01T12:00:00 ... 2045-12-30T12:00:00 (days) </span></span>
<span><span class="co">#&gt; Bounds     : 2041-01-01 ... 2046-01-01 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  ...</span></span></code></pre>
</div>
<div class="section level2">
<h2 id="axes-are-not-specified-properly">Axes are not specified properly<a class="anchor" aria-label="anchor" href="#axes-are-not-specified-properly"></a>
</h2>
<p>Sometimes when you open a netCDF file you find that the axes are
incompletely specified. While this may not generate an error or a
warning and the data will still be usable, certain operations on the
data are not possible, such as automatically orienting the data in a
certain way or exporting the data variables to a different format.</p>
<pre><code><span><span class="op">(</span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_ncdf.html">open_ncdf</a></span><span class="op">(</span><span class="st">"~/METEO_DATA_202003120000.NC"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Dataset&gt; METEO_DATA_202003120000.NC </span></span>
<span><span class="co">#&gt; Resource   : ~/METEO_DATA_202003120000.NC </span></span>
<span><span class="co">#&gt; Format     : classic4 </span></span>
<span><span class="co">#&gt; Collection : Generic netCDF data </span></span>
<span><span class="co">#&gt; Conventions: (not indicated) </span></span>
<span><span class="co">#&gt; Keep open  : FALSE </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Variables:</span></span>
<span><span class="co">#&gt;  name long_name                              units data_type  axes</span></span>
<span><span class="co">#&gt;  lwrc Incoming longwave radiation            W m-2 NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  sdri Incoming direct shortwave radiation... W m-2 NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  sdfd Incoming diffuse shortwave radiation   W m-2 NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  tais Air temperature at 10 m above ground   K     NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  rhus Relative humidity at 10 m above ground %     NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  pail Air pressure                           Pa    NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  wnsd Wind speed at 10 m above ground        m/s   NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  wndd Wind direction at 10 m above ground    deg   NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt;  proi Precipitation                          mm/hr NC_DOUBLE  time, northing, easting</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name               type      length value </span></span>
<span><span class="co">#&gt;  title              NC_CHAR   108    High-resolution hydrometeorological data for th...</span></span>
<span><span class="co">#&gt;  summary            NC_CHAR   244    This dataset contains high-resolution meteorolo...</span></span>
<span><span class="co">#&gt;  ...</span></span>
<span></span>
<span><span class="co"># Open a data variable</span></span>
<span><span class="op">(</span><span class="va">lwrc</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[[</span><span class="st">"lwrc"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt; &lt;Variable&gt; lwrc </span></span>
<span><span class="co">#&gt; Long name: Incoming longwave radiation </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Axes:</span></span>
<span><span class="co">#&gt;  axis name     long_name length values                                        unit</span></span>
<span><span class="co">#&gt;  T    time                24    [2020-03-12T00:00:00 ... 2020-03-12T23:00:00] days since 2020-03-12T00:00:00+01:00</span></span>
<span><span class="co">#&gt;       northing Northing  180    [189950 ... 172050]                           m</span></span>
<span><span class="co">#&gt;       easting  Easting   185    [776050 ... 794450]                           m</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name                  type      length value                           </span></span>
<span><span class="co">#&gt;  _FillValue            NC_DOUBLE  1     -9999                           </span></span>
<span><span class="co">#&gt;  standard_name         NC_CHAR   32     downwelling_longwave_flux_in_air</span></span>
<span><span class="co">#&gt;  long_name             NC_CHAR   27     Incoming longwave radiation     </span></span>
<span><span class="co">#&gt;  coverage_content_type NC_CHAR   11     modelResult                     </span></span>
<span><span class="co">#&gt;  units                 NC_CHAR    5     W m-2</span></span></code></pre>
<p>This all looks ok but the <code>northing</code> and
<code>easting</code> axes are not recognised as <code>Y</code> and
<code>X</code>. You can remedy that manually:</p>
<pre><code><span><span class="va">ax</span> <span class="op">&lt;-</span> <span class="va">lwrc</span><span class="op">$</span><span class="va">axes</span><span class="op">[[</span><span class="st">"northing"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ax</span><span class="op">$</span><span class="va">orientation</span> <span class="op">&lt;-</span> <span class="st">"Y"</span></span>
<span><span class="va">ax</span> <span class="op">&lt;-</span> <span class="va">lwrc</span><span class="op">$</span><span class="va">axes</span><span class="op">[[</span><span class="st">"easting"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">ax</span><span class="op">$</span><span class="va">orientation</span> <span class="op">&lt;-</span> <span class="st">"X"</span></span>
<span><span class="va">lwrc</span></span>
<span><span class="co">#&gt; &lt;Variable&gt; lwrc </span></span>
<span><span class="co">#&gt; Long name: Incoming longwave radiation </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Axes:</span></span>
<span><span class="co">#&gt;  axis name     long_name length values                                        unit</span></span>
<span><span class="co">#&gt;  T    time                24    [2020-03-12T00:00:00 ... 2020-03-12T23:00:00] days since 2020-03-12T00:00:00+01:00</span></span>
<span><span class="co">#&gt;  Y    northing Northing  180    [189950 ... 172050]                           m</span></span>
<span><span class="co">#&gt;  X    easting  Easting   185    [776050 ... 794450]                           m</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attributes:</span></span>
<span><span class="co">#&gt;  name                  type      length value                           </span></span>
<span><span class="co">#&gt;  _FillValue            NC_DOUBLE  1     -9999                           </span></span>
<span><span class="co">#&gt;  standard_name         NC_CHAR   32     downwelling_longwave_flux_in_air</span></span>
<span><span class="co">#&gt;  long_name             NC_CHAR   27     Incoming longwave radiation     </span></span>
<span><span class="co">#&gt;  coverage_content_type NC_CHAR   11     modelResult                     </span></span>
<span><span class="co">#&gt;  units                 NC_CHAR    5     W m-2</span></span></code></pre>
<p>Note that you have to do this only once: all nine data variables
share the same instance of the <code>northing</code> and
<code>easting</code> axes and it is those objects that the
<code>$orientation</code> field applies to.</p>
<p>The above procedure solves the issue for the currently loaded data.
If you want to fix the netCDF file permanently, you should open it for
writing, set the appropriate attributes and save the edits:</p>
<pre><code><span><span class="va">ds</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/open_ncdf.html">open_ncdf</a></span><span class="op">(</span><span class="st">"~/METEO_DATA_202003120000.NC"</span>, write <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">northing</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[[</span><span class="st">"northing"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">northing</span><span class="op">$</span><span class="fu">set_attribute</span><span class="op">(</span><span class="st">"standard_name"</span>, <span class="st">"NC_CHAR"</span>, <span class="st">"projected_y_coordinate"</span><span class="op">)</span></span>
<span><span class="va">northing</span><span class="op">$</span><span class="fu">set_attribute</span><span class="op">(</span><span class="st">"axis"</span>, <span class="st">"NC_CHAR"</span>, <span class="st">"Y"</span><span class="op">)</span></span>
<span><span class="va">easting</span> <span class="op">&lt;-</span> <span class="va">ds</span><span class="op">[[</span><span class="st">"easting"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">easting</span><span class="op">$</span><span class="fu">set_attribute</span><span class="op">(</span><span class="st">"standard_name"</span>, <span class="st">"NC_CHAR"</span>, <span class="st">"projected_x_coordinate"</span><span class="op">)</span></span>
<span><span class="va">easting</span><span class="op">$</span><span class="fu">set_attribute</span><span class="op">(</span><span class="st">"axis"</span>, <span class="st">"NC_CHAR"</span>, <span class="st">"X"</span><span class="op">)</span></span>
<span><span class="va">ds</span><span class="op">$</span><span class="fu">save</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Patrick Van Laake.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>

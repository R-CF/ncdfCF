# ncdfCF

The `ncdfCF` package provides an easy to use interface to netCDF
resources in R, either in local files or remotely on a THREDDS server.
It is built on the `RNetCDF` package which, like package `ncdf4`,
provides a basic interface to the `netcdf` library, but which lacks an
intuitive user interface. Package `ncdfCF` provides a high-level
interface using functions and methods that are familiar to the R user.
It reads the structural metadata and also the attributes upon opening
the resource. In the process, the `ncdfCF` package also applies CF
Metadata Conventions to interpret the data.

## Basic usage

Opening and inspecting the contents of a netCDF resource is very
straightforward:

``` r
library(ncdfCF)

# Get any netCDF file
fn <- system.file("extdata", "ERA5land_Rwanda_20160101.nc", package = "ncdfCF")

# Open the file, all metadata is read
(ds <- open_ncdf(fn))
#> <Dataset> ERA5land_Rwanda_20160101 
#> Resource   : /Library/Frameworks/R.framework/Versions/4.5-arm64/Resources/library/ncdfCF/extdata/ERA5land_Rwanda_20160101.nc 
#> Format     : offset64 
#> Collection : Generic netCDF data 
#> Conventions: CF-1.6 
#> 
#> Variables:
#>  name long_name             units data_type axes                     
#>  t2m  2 metre temperature   K     NC_DOUBLE longitude, latitude, time
#>  pev  Potential evaporation m     NC_DOUBLE longitude, latitude, time
#>  tp   Total precipitation   m     NC_DOUBLE longitude, latitude, time
#> 
#> Attributes:
#>  name        type    length value                             
#>  Conventions NC_CHAR  6     CF-1.6                            
#>  history     NC_CHAR 34     Attributes simplified for example.
```

You can convert a suitable R object into a `CFVariable` instance quite
easily. R objects that are supported include arrays, matrices and
vectors of type logical, integer, numeric or logical.

If the R object has `dimnames` set, these will be used to create more
informed axes. More interestingly, if your array represents some spatial
data you can give your `dimnames` appropriate names (“lat”, “lon”,
“latitude”, “longitude”, case-insensitive) and the corresponding axis
will be created (if the coordinate values in the `dimnames` are within
the domain of the axis type). For “time” coordinates, these are
automatically detected irrespective of the name.

``` r
# Note the use of named dimnames: these will become the names of the axes
arr <- array(rnorm(120), dim = c(6, 5, 4))
dimnames(arr) <- list(lat = c(45, 44, 43, 42, 41, 40), lon = c(0, 1, 2, 3, 4), 
                      time = c("2025-07-01", "2025-07-02", "2025-07-03", "2025-07-04"))

(obj <- as_CF("a_new_CF_object", arr))
#> <Variable> a_new_CF_object 
#> 
#> Values: [-1.716299 ... 1.90904] 
#>     NA: 0 (0.0%)
#> 
#> Axes:
#>  axis name length values                      unit                          
#>  Y    lat  6      [45 ... 40]                 degrees_north                 
#>  X    lon  5      [0 ... 4]                   degrees_east                  
#>  T    time 4      [2025-07-01 ... 2025-07-04] days since 1970-01-01T00:00:00
#> 
#> Attributes:
#>  name         type      length value             
#>  actual_range NC_DOUBLE 2      -1.716299, 1.90904

# Axes are of a specific type and have basic attributes set
obj$axes[["lat"]]
#> <Latitude axis> [-2] lat
#> Length     : 6
#> Axis       : Y 
#> Coordinates: 45, 44, 43, 42, 41, 40 (degrees_north)
#> Bounds     : (not set)
#> 
#> Attributes:
#>  name          type      length value        
#>  actual_range  NC_DOUBLE  2     40, 45       
#>  axis          NC_CHAR    1     Y            
#>  standard_name NC_CHAR    8     latitude     
#>  units         NC_CHAR   13     degrees_north

obj$axes[["time"]]
#> <Time axis> [-4] time
#> Length     : 4
#> Axis       : T 
#> Calendar   : standard 
#> Range      : 2025-07-01 ... 2025-07-04 (days) 
#> Bounds     : (not set) 
#> 
#> Attributes:
#>  name          type      length value                         
#>  actual_range  NC_DOUBLE  2     20270, 20273                  
#>  axis          NC_CHAR    1     T                             
#>  standard_name NC_CHAR    4     time                          
#>  units         NC_CHAR   30     days since 1970-01-01T00:00:00
#>  calendar      NC_CHAR    8     standard
```

You can further modify the resulting `CFVariable` by setting other
properties, such as attributes or a coordinate reference system. Once
the object is complete, you can export or save it.

More detailed operations and options are given on the [package web
site](https://r-cf.github.io/ncdfCF/).

## Development plan

Package `ncdfCF` is still being developed. It supports reading of all
data objects from netCDF resources in “classic” and “netcdf4” formats;
and can write data variables back to a netCDF file. From the CF Metadata
Conventions it supports identification of axes, interpretation of the
“time” axis, name resolution when using groups, cell boundary
information, auxiliary coordinate variables, labels, cell measures,
attributes and grid mapping information, among others.

Development plans for the near future focus on supporting the below
features:

##### netCDF

- Writing data to an unlimited dimension of a data variable.

##### CF Metadata Conventions

- Cell methods.
- Aggregation.
- Support for discrete sampling geometries.
- Compliance with CMIP5 / CMIP6 requirements.

## Installation

Package `ncdfCF` is still being developed. While extensively tested on
multiple well-structured data sets, errors may still occur, particularly
in data sets that do not adhere to the CF Metadata Conventions. The API
may still change and although care is taken not to make breaking
changes, sometimes this is unavoidable.

Installation from CRAN of the latest release:

``` R
install.packages("ncdfCF")
```

You can install the development version of `ncdfCF` from
[GitHub](https://github.com/) with:

``` R
# install.packages("devtools")
devtools::install_github("R-CF/ncdfCF")
```

# Package index

## Main ncdfCF classes and operations

### Opening and inspecting netCDF resources

NetCDF resources can be accessed on local (or networked) file systems,
or on THREDDS server on the internet. NetCDF resources are opened by
default for read-only access but local resources may be opened for
writing as well (THREDDS servers do not support writing).

- [`open_ncdf()`](https://r-cf.github.io/ncdfCF/reference/open_ncdf.md)
  : Open a netCDF resource
- [`peek_ncdf()`](https://r-cf.github.io/ncdfCF/reference/peek_ncdf.md)
  : Examine a netCDF resource

### Data set

The main object that the ncdfCF package presents to the R user is a
`CFDataset`. When opening an existing netCDF resource, the `CFDataset`
will provide access to all data variables and associated objects in the
resource, including its attributes, in a ready-made way for usage. The
CF Conventions will have been applied and the objects within the
`CFDataset` are thus fully formed and linked.

- [`create_ncdf()`](https://r-cf.github.io/ncdfCF/reference/create_ncdf.md)
  : Create a new data set

- [`as_CF()`](https://r-cf.github.io/ncdfCF/reference/as_CF.md) :

  Create a `CFDataset` or `CFVariable` instance from an R object

- [`CFDataset`](https://r-cf.github.io/ncdfCF/reference/CFDataset.md) :
  CF data set

- [`CFGroup`](https://r-cf.github.io/ncdfCF/reference/CFGroup.md) :
  Group for CF objects

- [`names(`*`<CFDataset>`*`)`](https://r-cf.github.io/ncdfCF/reference/dimnames.md)
  : Names or axis values of an CF object

- [`groups()`](https://r-cf.github.io/ncdfCF/reference/groups.md) : List
  the groups in the CF object, recursively.

- [`` `[[`( ``*`<CFDataset>`*`)`](https://r-cf.github.io/ncdfCF/reference/sub-sub-.CFDataset.md)
  : Get a CF object from a data set

### Data variable

A data set can hold one or more data variables. A data variable is the
object that holds the data and descriptive metadata for a variable of
interest, such as daily maximum temperature. In R you can operate
directly on a data variable but it can also be subsetted, profiled and
summarised over the “time” dimension. It can be saved to a new netCDF
resource or exported to some other format.

- [`CFVariable`](https://r-cf.github.io/ncdfCF/reference/CFVariable.md)
  : CF data variable

- [`CFVariableL3b`](https://r-cf.github.io/ncdfCF/reference/CFVariableL3b.md)
  : CF data variable for the NASA L3b format

- [`CFGridMapping`](https://r-cf.github.io/ncdfCF/reference/CFGridMapping.md)
  : CF grid mapping object

- [`CFCellMeasure`](https://r-cf.github.io/ncdfCF/reference/CFCellMeasure.md)
  : CF cell measure variable

- [`CFAuxiliaryLongLat`](https://r-cf.github.io/ncdfCF/reference/CFAuxiliaryLongLat.md)
  : CF auxiliary longitude-latitude variable

- [`` `[`( ``*`<CFVariable>`*`)`](https://r-cf.github.io/ncdfCF/reference/sub-.CFVariable.md)
  : Extract data for a variable

- [`` `[`( ``*`<CFVariableL3b>`*`)`](https://r-cf.github.io/ncdfCF/reference/sub-.CFVariableL3b.md)
  : Extract data for a variable

- [`aoi()`](https://r-cf.github.io/ncdfCF/reference/aoi.md) : Area of
  Interest

- [`dim(`*`<AOI>`*`)`](https://r-cf.github.io/ncdfCF/reference/dim.AOI.md)
  : The dimensions of the grid of an AOI

- [`Ops(`*`<CFVariable>`*`)`](https://r-cf.github.io/ncdfCF/reference/arrayOps.md)
  [`Math(`*`<CFVariable>`*`)`](https://r-cf.github.io/ncdfCF/reference/arrayOps.md)
  : Operations on CFVariable objects

- [`geom_ncdf()`](https://r-cf.github.io/ncdfCF/reference/geom_ncdf.md)
  :

  Create a plot object for a `CFVariable`

### Axes

The shape of a data variable is described by the set of axes that it
links to. There are specialised axes for specific types of axes, such as
for longitude and latitude, or more generic types, each having their own
class inheriting from the “virtual” `CFAxis` class.

- [`makeAxis()`](https://r-cf.github.io/ncdfCF/reference/makeAxis.md) :
  Create an axis
- [`makeCharacterAxis()`](https://r-cf.github.io/ncdfCF/reference/makeCharacterAxis.md)
  : Create a character axis
- [`makeDiscreteAxis()`](https://r-cf.github.io/ncdfCF/reference/makeDiscreteAxis.md)
  : Create a discrete axis
- [`makeLongitudeAxis()`](https://r-cf.github.io/ncdfCF/reference/makeLongitudeAxis.md)
  : Create a longitude axis
- [`makeLatitudeAxis()`](https://r-cf.github.io/ncdfCF/reference/makeLatitudeAxis.md)
  : Create a latitude axis
- [`makeTimeAxis()`](https://r-cf.github.io/ncdfCF/reference/makeTimeAxis.md)
  : Create a time axis
- [`makeVerticalAxis()`](https://r-cf.github.io/ncdfCF/reference/makeVerticalAxis.md)
  : Create a vertical axis
- [`CFAxis`](https://r-cf.github.io/ncdfCF/reference/CFAxis.md) : CF
  axis object
- [`CFAxisCharacter`](https://r-cf.github.io/ncdfCF/reference/CFAxisCharacter.md)
  : CF character axis object
- [`CFAxisDiscrete`](https://r-cf.github.io/ncdfCF/reference/CFAxisDiscrete.md)
  : CF discrete axis object
- [`CFAxisNumeric`](https://r-cf.github.io/ncdfCF/reference/CFAxisNumeric.md)
  : Numeric CF axis object
- [`CFAxisLongitude`](https://r-cf.github.io/ncdfCF/reference/CFAxisLongitude.md)
  : Longitude CF axis object
- [`CFAxisLatitude`](https://r-cf.github.io/ncdfCF/reference/CFAxisLatitude.md)
  : Latitude CF axis object
- [`CFAxisTime`](https://r-cf.github.io/ncdfCF/reference/CFAxisTime.md)
  : Time axis object
- [`CFAxisVertical`](https://r-cf.github.io/ncdfCF/reference/CFAxisVertical.md)
  : Vertical CF axis object
- [`CFVerticalParametricTerm`](https://r-cf.github.io/ncdfCF/reference/CFVerticalParametricTerm.md)
  : Parametric formula term for a vertical CF axis object
- [`CFLabel`](https://r-cf.github.io/ncdfCF/reference/CFLabel.md) : CF
  label object
- [`dim(`*`<CFAxis>`*`)`](https://r-cf.github.io/ncdfCF/reference/dim.CFAxis.md)
  : Axis length

### ncdfCF objects

This package uses many base classes to “glue” all the objects together.
In typical use of the package these classes are not very useful, the
higher-level objects encapsulate these low-level objects. For developers
it could be useful to study or directly access these classes.

- [`CFObject`](https://r-cf.github.io/ncdfCF/reference/CFObject.md) : CF
  base object
- [`CFBounds`](https://r-cf.github.io/ncdfCF/reference/CFBounds.md) : CF
  boundary variable
- [`CFData`](https://r-cf.github.io/ncdfCF/reference/CFData.md) : CF
  data object
- [`CFStandardNames`](https://r-cf.github.io/ncdfCF/reference/CFStandardNames.md)
  : CF Standard names table

### NetCDF objects

When opening an existing netCDF resource, or after writing a new netCDF
file, the contents of the netCDF resource are captured in a hierarchy of
NC objects. These objects are immutable for the R user because they
reflect what is in the resource.

- [`NCResource`](https://r-cf.github.io/ncdfCF/reference/NCResource.md)
  : NetCDF resource object
- [`NCObject`](https://r-cf.github.io/ncdfCF/reference/NCObject.md) :
  NetCDF base object
- [`NCGroup`](https://r-cf.github.io/ncdfCF/reference/NCGroup.md) :
  NetCDF group
- [`NCDimension`](https://r-cf.github.io/ncdfCF/reference/NCDimension.md)
  : NetCDF dimension object
- [`NCVariable`](https://r-cf.github.io/ncdfCF/reference/NCVariable.md)
  : NetCDF variable

# Articles

### All vignettes

- [1. Creating new data sets and
  variables](https://r-cf.github.io/ncdfCF/articles/31_Creating.md):
- [2. R and CF Metadata
  Conventions](https://r-cf.github.io/ncdfCF/articles/32_R-CF.md):
- [3.
  Troubleshooting](https://r-cf.github.io/ncdfCF/articles/33_Troubleshooting.md):
- [Using ncdfCF](https://r-cf.github.io/ncdfCF/articles/ncdfCF.md):
